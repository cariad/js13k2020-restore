<html><head><meta name=viewport content="width=device-width,initial-scale=1"><title>RESTORE</title><meta charset=UTF-8><style>body{margin:0}</style></head><body><canvas id=c width=800 height=600></canvas><script>var e,t,o,i=Math.floor,l=document.getElementById("c"),a=l.getContext("2d"),r=(e,t)=>e.forEach(t),n=[],f=(e,i,l,a)=>{for(var r=a/81*10,n=l,f=e?t.f:o.f,h=0;h<f.length;h++)n=9+s(e,f[h],i,n,a,r)},s=(t,o,i,l,r,n)=>{var f,s;a.fillStyle="black",a.font="bold 16px monospace",a.textAlign="left",a.fillText(o.i,i,l);var h=l+16,g=h;e&&t&&(s=e.p.find(e=>e.i==o.i),f=e.o.find(e=>e.i==o.i),(s||f)&&(h+=u(10,5,n)/2));for(var b=v(e=>{e.fillStyle=c,e.fillRect(0,0,81,10)},81,10,i,h,r,[0,0,0],0),p=0;p<8;p++)v(e=>{var t=Math.pow(2,8-p-1);e.fillStyle=(o.b&t)==t?d:m,e.fillRect(1,1,9,8)},10,10,i+p*n,h,n,[0,255,0],160);if(f)for(p=0;p<8;p++)(f.b&(y=Math.pow(2,8-p-1)))==y&&v(e=>{e.beginPath(),e.moveTo(1,4),e.lineTo(5,0),e.lineTo(6,0),e.lineTo(10,4),e.closePath(),e.fillStyle=c,e.fill(),e.strokeStyle=m,e.stroke()},10,5,i+p*n,g,n,[255,0,0],180);if(s)for(p=0;p<8;p++){var y;(s.b&(y=Math.pow(2,8-p-1)))==y&&v(e=>{e.beginPath(),e.moveTo(1,0),e.lineTo(5,4),e.lineTo(6,4),e.lineTo(10,0),e.closePath(),e.fillStyle=c,e.fill(),e.strokeStyle=m,e.stroke()},10,5,i+p*n,g,n,[0,0,255],180)}return h+b},h=()=>{var e=l.width=window.innerWidth,i=l.height=window.innerHeight,r=Math.min((e-.02*e*2)/3,(i-.02*i*2)/2),n=.02*r,s=r-2*n,h=e/2-3*r/2,v=i/2-2*r/2;a.fillStyle="lightgray",a.fillRect(0,0,e,i),a.fillStyle="black",a.font="bold 22px cursive",a.textAlign="left",a.textBaseline="top",a.fillText(`${e} x ${i}`,0,0);var u=v+n,c=v+r+n,g=h+n,d=h+r+n,m=h+r+r+n;o&&(f(!1,d,u,s),b(o,m,u,s)),b(t,g,c,s,!0),f(!0,d,c,s)},v=(e,t,o,i,l,r,n,f,s)=>{var h=document.createElement("canvas"),v=h.getContext("2d");h.width=t,h.height=o,v.lineWidth=1,e(v);for(var c=v.getImageData(0,0,t,o),g=[],d=0;d<o;d++)for(var m=0;m<t;m++){var b,p=d*(4*t)+4*(s?t-m-1:m);c.data[p+3]<128?(g.push(0),g.push(0),g.push(0),g.push(0)):(b=c.data[p+0]>=128?n:n.map(c.data[p+1]>=128?e=>e+f:e=>e-f),g.push(b[0]),g.push(b[1]),g.push(b[2]),g.push(255))}for(var y=0;y<g.length;y++)c.data[y]=g[y];v.clearRect(0,0,t,o),v.putImageData(c,0,0);var w=u(t,o,r);return a.imageSmoothingEnabled=!1,a.drawImage(h,i,l,r,w),a.imageSmoothingEnabled=!0,w},u=(e,t,o)=>o/e*t,c="#f00",d="#0f0",m="#00f",b=(e,t,o,i,l)=>{var a=(e,t)=>{e.strokeStyle=c,e.fillStyle=d,r(t,t=>{e.beginPath(),e.moveTo(t[0],t[1]),e.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7]),e.fill(),e.stroke()})},n=e.a;v(e=>a(e,n.hs[0]),31,31,t,o,i,n.ht,64,l),v(e=>{e.strokeStyle=c,e.fillStyle=d,p(e,5,5,20,20,n.hr)},31,31,t,o,i,n.s,40,l),v(e=>{e.fillStyle=c,e.fillRect(7,n.ey,4,n.eh),e.fillRect(11+n.eg,n.ey,4,n.eh),e.fillStyle=m,e.fillRect(8,n.ey+1,1,1),e.fillRect(11+n.eg+1,n.ey+1,1,1)},31,31,t,o,i,[255,255,255],255,l),v(e=>{e.fillStyle=m;var t=n.m[0]/3+n.m[2],o=19+n.m[1],i=n.m[0]/3*2+n.m[2],l=19+n.m[1],a=n.m[2]+n.m[0];e.beginPath(),e.moveTo(n.m[2],19),e.bezierCurveTo(t,o,i,l,a,19),e.stroke()},31,31,t,o,i,n.s,110,l),v(e=>a(e,n.hs[1]),31,31,t,o,i,n.ht,64,l)},p=(e,t,o,i,l,a)=>{e.beginPath(),e.moveTo(t+a,o),e.lineTo(t+i-a,o),e.quadraticCurveTo(t+i,o,t+i,o+a),e.lineTo(t+i,o+l-a),e.quadraticCurveTo(t+i,o+l,t+i-a,o+l),e.lineTo(t+a,o+l),e.quadraticCurveTo(t,o+l,t,o+l-a),e.lineTo(t,o+a),e.quadraticCurveTo(t,o,t+a,o),e.closePath(),e.fill(),e.stroke()},y=(e,t,o,i,l)=>{n.push({x:e,y:t,xa:e+o,ya:t+i,t:l,w:o,h:i})},w=(new Date).getMinutes(),S=(new Date).getSeconds(),T=(e=10)=>{var t=(w+S)/100,o=i(100*(t-i(t)));return w=S,S=o,o%e},k=()=>[4,0].reduce((e,t)=>(e+=T(14)+1)<<t,0),x=e=>{console.info(e.n+" holds:"),r(e.f,e=>console.info(`> (file ID: ${(""+e.i).padStart(2,"0")}) ${P(e.b)}`))},P=e=>e.toString(2).padStart(8,0),A=()=>{t=E(!0,3,"Bob"),$()},$=()=>{var e;o=E(!0,3,((e=[])[0]=["Astro","Captain","Enchanter","Pirate","Priest","Sales Manager","g","h","i","j"][T()],e[1]=["Nigel","Fyodor","Jam","Jonas","Lucas","f","g","h","i","j"][T()],e[2]=["Keyboard","Planet","Soul","Video","e","f","g","h","i","j"][T()]+["jammer","crusher","juicer","b","e","f","g","h","i","j"][T()],e.join(" "))),D()},C=(e,t)=>{for(var o=[],i=[],l=0;l<e;l++)o.push(l);for(l=0;l<t;l++)i.push(o.splice(T(o.length),1)[0]);return i},E=(e,t,o)=>{var i={f:[],n:o,a:{s:[[197,140,133],[236,188,180],[80,51,53],[89,47,42]][T(4)].map(e=>e+1.5*(T()-4)),ht:[128*T(2),128*T(2),128*T(2)],hs:[[[],[]],[[[4,8,-6,34,20,34,8,1]],[[22,10,12,36,38,36,26,3],[26,3,-9,-6,-3,18,25,9]]],[[],[[22,6,6,-7,-7,17,21,8]]]][T(3)],hr:T(6)+3,ey:T(3)+12,eg:T(2)+2,eh:T(2)+2,m:[[10,2,8],[12,4,7]][T(2)]}};return e&&i.f.push({m:2,b:k(),i:0}),r(C(8,t),e=>i.f.push({m:1,b:k(),i:e+1})),i.f.filter(e=>0==e.b)==i.f.length?(console.error("All zeroes?!"),null):i},M=e=>{for(var t=0;e>0;)e&=e-1,t++;return t},R=(e,t)=>M(e)*t,j=(e,t)=>e.f.find(e=>e.i==t),q=e=>console.debug(`> "${P(e.b)}" of file (${e.i}) worth $${e.v}.`),I=(e,t)=>{(g=e.f.find(e=>e.i==t.i))?g.b+=t.b:e.f.push({m:1,b:t.b,i:t.i})},D=()=>{var l,a,n,f,s=(f={v:0},r((n=a=o,(l=t).f.map(e=>e.i).filter(e=>n.f.map(e=>e.i).includes(e))),e=>{var t=j(l,e),o=(j(a,e).b^t.b)&t.b,i=R(o,t.m);i>f.v&&(f.i=e,f.b=o,f.v=i)}),f.v>0?f:null);if(!s)return console.warn(`You have nothing of value to ${o.n}.`),void $();var v,u=((e,t,o)=>{var l=[];(l=e.f.map(o=>((e,t,o)=>{var i={i:o},l=j(e,o),a=j(t,o);return i.b=((a?a.b:0)^l.b)&l.b,i.v=R(i.b,l.m),i.e=l.m,i})(e,t,o.i)).filter(e=>e.b>0)).sort((e,t)=>e.v>t.v);var a=[],n=0;return r(l,e=>{if(e.v+n-o>0){var t=i((o-n)/e.e);if(!t)return;for(var l=C(8,8).map(e=>Math.pow(2,e));M(e.b)>t;){var r=l.pop();(e.b&r)==r&&(e.b-=r)}e.v=R(e.b,e.e)}a.push(e),n+=e.v}),a})(o,t,s.v);if(0==u.length)return console.warn(o.n+" has nothing of value to you."),void $();v=e={o:[s],p:u},console.info("There's an offer on the table!"),console.info(o.n+" will take:"),r(v.o,e=>q(e)),console.info(`In return, ${o.n} will offer:`),r(v.p,e=>q(e)),requestAnimationFrame(h)};l.addEventListener("click",i=>{var l=i.offsetX,a=i.offsetY,f=n.reverse().find(e=>e.x<l&&l<e.xa&&e.y<a&&a<e.ya);f?(console.log("hit",l,a),"Accept"==f.t?(n=[],(i=>{r(e.o,e=>I(o,e)),r(e.p,e=>I(t,e)),e=null;var l=255==j(t,0).b,a=255==j(o,0).b;l&&a||l?(console.warn("You won! :)"),x(t),y(50,50,100,50,"Again")):a?(console.warn(o.n+" won! :("),x(o),y(50,50,100,50,"Again")):(console.info(o.n+" walks away with:"),x(o),$()),requestAnimationFrame(h)})()):"Again"==f.t?(n=[],A()):console.log(f.t)):console.log("missed",l,a)}),window.addEventListener("resize",h,!0),window.addEventListener("orientationchange",h,!0),A();</script></body></html>