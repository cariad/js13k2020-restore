<html><head><meta name=viewport content="width=device-width,initial-scale=1"><title>RESTORE</title><meta charset=UTF-8><style>body{margin:0}</style></head><body><canvas id=c width=800 height=600></canvas><script>var e,t=Math.floor,a=document.getElementById("c"),o=a.getContext("2d"),i=(e,t)=>e.forEach(t),n=[],r=()=>{var r=a.width=window.innerWidth,l=a.height=window.innerHeight;if(o.fillStyle="yellow",o.fillRect(0,0,r,l),o.fillStyle="black",o.font="bold 22px cursive",o.textAlign="left",o.textBaseline="top",o.fillText(`${r} x ${l}`,0,0),f){var s=t(r/2)-20,h=l-40,v=s>h?h:s;c(.75*r-v/2,l/2-v/2,v)}e&&(m(50,50,100,50,"Accept"),m(200,50,100,50,"Counter")),o.font="bold 22px cursive",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#000",i(n,e=>{o.fillText(e.t,e.x+e.w/2,e.y+e.h/2,e.w,e.h),o.strokeRect(e.x,e.y,e.w,e.h)})};window.addEventListener("resize",r,!0),window.addEventListener("orientationchange",r,!0);var l,f,s=(e,t,a,i,n,r)=>{var l=document.createElement("canvas"),f=l.getContext("2d"),s=l.width=31,h=l.height=31;f.lineWidth=1,e(f);for(var v=f.getImageData(0,0,s,h),d=0;d<s*h*4;){var c,u=d+3;v.data[u]<128?v.data[u]=0:(c=v.data[d+0]>=128?i:i.map(v.data[d+1]>=128?e=>e+n:e=>e-n),v.data[d+0]=c[0],v.data[d+1]=c[1],v.data[d+2]=c[2],v.data[u]=255),d+=4}f.clearRect(0,0,s,h),f.putImageData(v,0,0),o.imageSmoothingEnabled=!1,o.drawImage(l,t,a,r,r/s*h),o.imageSmoothingEnabled=!0},h="#f00",v="#0f0",d="#00f",c=(e,t,a)=>{var o=(e,t)=>{e.strokeStyle=h,e.fillStyle=v,i(t,t=>{e.beginPath(),e.moveTo(t[0],t[1]),e.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7]),e.fill(),e.stroke()})},n=f.a;s(e=>o(e,n.hs[0]),e,t,n.ht,64,a),s(e=>{e.strokeStyle=h,e.fillStyle=v,u(e,5,5,20,20,f.a.hr)},e,t,n.s,40,a),s(e=>{e.fillStyle=h,e.fillRect(7,n.ey,4,n.eh),e.fillRect(11+n.eg,n.ey,4,n.eh),e.fillStyle=d,e.fillRect(8,n.ey+1,1,1),e.fillRect(11+n.eg+1,n.ey+1,1,1)},e,t,[255,255,255],255,a),s(e=>{e.fillStyle=d;var t=n.m[0]/3+n.m[2],a=19+n.m[1],o=n.m[0]/3*2+n.m[2],i=19+n.m[1],r=n.m[2]+n.m[0];e.beginPath(),e.moveTo(n.m[2],19),e.bezierCurveTo(t,a,o,i,r,19),e.stroke()},e,t,n.s,110,a),s(e=>o(e,n.hs[1]),e,t,n.ht,64,a)},u=(e,t,a,o,i,n)=>{e.beginPath(),e.moveTo(t+n,a),e.lineTo(t+o-n,a),e.quadraticCurveTo(t+o,a,t+o,a+n),e.lineTo(t+o,a+i-n),e.quadraticCurveTo(t+o,a+i,t+o-n,a+i),e.lineTo(t+n,a+i),e.quadraticCurveTo(t,a+i,t,a+i-n),e.lineTo(t,a+n),e.quadraticCurveTo(t,a,t+n,a),e.closePath(),e.fill(),e.stroke()},m=(e,t,a,o,i)=>{n.push({x:e,y:t,xa:e+a,ya:t+o,t:i,w:a,h:o})},b=(new Date).getMinutes(),w=(new Date).getSeconds(),p=(e=10)=>{var a=(b+w)/100,o=t(100*(a-t(a)));return b=w,w=o,o%e},y=()=>[2,2,2,0].reduce((e,t)=>(e+=p(4))<<t,0),S=e=>{console.info(e.n+" holds:"),i(e.f,e=>console.info(`> (file ID: ${(""+e.i).padStart(2,"0")}) ${x(e.b)}`))},x=e=>e.toString(2).padStart(8,0),T=()=>{l=C(!0,3,"Bob"),k()},k=()=>{var e;S(l),f=C(!0,3,((e=[])[0]=["Astro","Captain","Enchanter","Pirate","Priest","Sales Manager","g","h","i","j"][p()],e[1]=["Nigel","Fyodor","Jam","Jonas","Lucas","f","g","h","i","j"][p()],e[2]=["Keyboard","Planet","Soul","Video","e","f","g","h","i","j"][p()]+["jammer","crusher","juicer","b","e","f","g","h","i","j"][p()],e.join(" "))),S(f),q()},A=(e,t)=>{for(var a=[],o=[],i=0;i<e;i++)a.push(i);for(i=0;i<t;i++)o.push(a.splice(p(a.length),1)[0]);return o},C=(e,t,a)=>{var o={f:[],n:a,a:{s:[[197,140,133],[236,188,180],[80,51,53],[89,47,42]][p(4)].map(e=>e+1.5*(p()-4)),ht:[128*p(2),128*p(2),128*p(2)],hs:[[[],[]],[[[4,8,-6,34,20,34,8,1]],[[22,10,12,36,38,36,26,3],[26,3,-9,-6,-3,18,25,9]]],[[],[[22,6,6,-7,-7,17,21,8]]]][p(3)],hr:p(6)+3,ey:p(3)+12,eg:p(2)+2,eh:p(2)+2,m:[[10,2,8],[12,4,7]][p(2)]}};return e&&o.f.push({m:2,b:y(),i:0}),i(A(8,t),e=>o.f.push({m:1,b:y(),i:e+1})),o},$=e=>{for(var t=0;e>0;)e&=e-1,t++;return t},E=(e,t)=>$(e)*t,j=(e,t)=>e.f.find(e=>e.i==t),P=e=>console.debug(`> "${x(e.b)}" of file (${e.i}) worth $${e.v}.`),R=(e,t)=>{(g=e.f.find(e=>e.i==t.i))?g.b+=t.b:e.f.push({m:1,b:t.b,i:t.i})},q=()=>{var a,o,n,s,h=(s={v:0},i((n=o=f,(a=l).f.map(e=>e.i).filter(e=>n.f.map(e=>e.i).includes(e))),e=>{var t=j(a,e),i=(j(o,e).b^t.b)&t.b,n=E(i,t.m);n>s.v&&(s.i=e,s.b=i,s.v=n)}),s.v>0?s:null);if(!h)return console.warn(`You have nothing of value to ${f.n}.`),void k();var v,d=((e,a,o)=>{var n=[];(n=e.f.map(t=>((e,t,a)=>{var o={i:a},i=j(e,a),n=j(t,a);return o.b=((n?n.b:0)^i.b)&i.b,o.v=E(o.b,i.m),o.e=i.m,o})(e,a,t.i)).filter(e=>e.b>0)).sort((e,t)=>e.v>t.v);var r=[],l=0;return i(n,e=>{if(e.v+l-o>0){var a=t((o-l)/e.e);if(!a)return;for(var i=A(8,8).map(e=>Math.pow(2,e));$(e.b)>a;){var n=i.pop();(e.b&n)==n&&(e.b-=n)}e.v=E(e.b,e.e)}r.push(e),l+=e.v}),r})(f,l,h.v);if(console.debug("lowTransactions",d),0==d.length)return console.warn(f.n+" has nothing of value to you."),void k();v=e={o:[h],p:d},console.info("There's an offer on the table!"),console.info(f.n+" will take:"),i(v.o,e=>P(e)),console.info(`In return, ${f.n} will offer:`),i(v.p,e=>P(e)),requestAnimationFrame(r)};a.addEventListener("click",t=>{var a=t.offsetX,o=t.offsetY,s=n.reverse().find(e=>e.x<a&&a<e.xa&&e.y<o&&o<e.ya);s?(console.log("hit",a,o),"Accept"==s.t?(n=[],(t=>{i(e.o,e=>R(f,e)),i(e.p,e=>R(l,e)),e=null;var a=255==j(l,0).b,o=255==j(f,0).b;a&&o||a?(console.warn("You won! :)"),S(l),m(50,50,100,50,"Again")):o?(console.warn(f.n+" won! :("),S(f),m(50,50,100,50,"Again")):(console.info(f.n+" walks away with:"),S(f),k()),requestAnimationFrame(r)})()):"Again"==s.t?(n=[],T()):console.log(s.t)):console.log("missed",a,o)}),T();</script></body></html>