<html><head><meta name=viewport content="width=device-width,initial-scale=1"><title>RESTORE</title><meta charset=UTF-8><style>#c{margin:50px auto 0;display:block;border:3px solid purple;border-radius:3px}</style></head><body><canvas id=c width=800 height=600></canvas><script>var r,e,o=Math.floor,n=document.getElementById("c"),a=(n.getContext("2d"),[]),f=4,t=7,i=(r=10)=>{var e=(f+t)/10,n=o(10*(e-o(e)));return f=t,t=n,n%r},v=()=>[2,2,2,0].reduce((r,e)=>(r+=i(4))<<e,0),s=r=>{console.info(r.n+" currently holds:"),r.f.forEach(r=>console.info(`> (file ID: ${(""+r.i).padStart(2,"0")}) ${l(r.b)}`))},l=r=>r.toString(2).padStart(8,0),c=(r,e)=>{for(var o=[],n=[],a=0;a<r;a++)o.push(a);for(a=0;a<e;a++)n.push(o.splice(i(o.length),1)[0]);return n},b=(r,e,o)=>{var n={f:[],n:o};return r&&n.f.push({m:2,b:v(),i:0}),c(8,e).forEach(r=>n.f.push({m:1,b:v(),i:r+1})),n},u=r=>{for(var e=0;r>0;)r&=r-1,e++;return e},d=(r,e)=>u(r)*e,h=(r,e)=>r.f.find(r=>r.i==e),p=r=>console.debug(`[transaction] "${l(r.b)}" of file (${r.i}) worth $${r.v}.`);n.addEventListener("click",r=>{var e=r.offsetX,o=r.offsetY,n=a.reverse().find(r=>r.x<e&&e<r.xa&&r.y<o&&o<r.ya);n?console.log(n.t):console.log("missed",e,o)}),s(r=b(!0,3,"Bob")),s(e=b(!0,3,"Weirdbeard")),(()=>{var n,a,f,t,i,v=(i={v:0},(f=n=r,t=a=e,f.f.map(r=>r.i).filter(r=>t.f.map(r=>r.i).includes(r))).forEach(r=>{var e=h(n,r),o=(h(a,r).b^e.b)&e.b,f=d(o,e.m);f>i.v&&(i.i=r,i.b=o,i.v=f)}),i);console.info(e.n+" wants:"),p(v);var s=((r,e,n)=>{var a=[];(a=r.f.map(o=>((r,e,o)=>{var n={i:o},a=h(r,o),f=h(e,o);return n.b=((f?f.b:0)^a.b)&a.b,n.v=d(n.b,a.m),n.e=a.m,n})(r,e,o.i))).sort((r,e)=>r.v>e.v);var f=[],t=0;return a.forEach(r=>{if(r.v+t-n>0){var e=o((n-t)/r.e);if(!e)return;for(var a=c(8,8).map(r=>Math.pow(2,r));u(r.b)>e;){var i=a.pop();(r.b&i)==i&&(r.b-=i)}r.v=d(r.b,r.e)}f.push(r),t+=r.v}),f})(e,r,v.v);console.info(`In return, ${e.n} will offer:`),s.forEach(r=>p(r))})();</script></body></html>